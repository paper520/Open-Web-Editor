/*!
* Open Web Editor - ✍️ An Editor Used on the Browser Side.
* git+https://github.com/hai2007/Open-Web-Editor.git
*
* author 你好2007
*
* version 0.3.0
*
* Copyright (c) 2020-2021 hai2007 走一步，再走一步。
* Released under the MIT license
*
* Date:Sat Jan 23 2021 02:09:12 GMT+0800 (GMT+08:00)
*/

"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(!e)return;if(typeof e==="string")return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor)n=e.constructor.name;if(n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}function _iterableToArray(e){if(typeof Symbol!=="undefined"&&Symbol.iterator in Object(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayLikeToArray(e,t){if(t==null||t>e.length)t=e.length;for(var n=0,r=new Array(t);n<t;n++){r[n]=e[n]}return r}function _defineProperty(e,t,n){if(t in e){Object.defineProperty(e,t,{value:n,enumerable:true,configurable:true,writable:true})}else{e[t]=n}return e}function _typeof(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function e(t){return typeof t}}else{_typeof=function e(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t}}return _typeof(e)}(function(){"use strict";var e;function n(e){var t=_typeof(e);return e!=null&&(t==="object"||t==="function")}var t=Object.prototype.toString;function r(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return t.call(e)}function i(e){var t=_typeof(e);return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&r(e)==="[object String]"}function o(e){if(!n(e)){return false}var t=r(e);return t==="[object Function]"||t==="[object AsyncFunction]"||t==="[object GeneratorFunction]"||t==="[object Proxy]"}function s(e){if(e===null||_typeof(e)!=="object"||r(e)!="[object Object]"){return false}if(Object.getPrototypeOf(e)===null){return true}var t=e;while(Object.getPrototypeOf(t)!==null){t=Object.getPrototypeOf(t)}return Object.getPrototypeOf(e)===t}var l=function e(t,n){return n!==null&&_typeof(n)==="object"&&t.indexOf(n.nodeType)>-1&&!s(n)};var a=i;var f=o;var u=function e(t){return Array.isArray(t)};var _=function e(t){return l([1,9,11],t)};var h={stopPropagation:function e(t){t=t||window.event;if(t.stopPropagation){t.stopPropagation()}else{t.cancelBubble=true}},preventDefault:function e(t){t=t||window.event;if(t.preventDefault){t.preventDefault()}else{t.returnValue=false}},bind:function e(t,n,r){if(window.attachEvent){t.attachEvent("on"+n,r)}else{t.addEventListener(n,r,false)}},trigger:function e(t,n){var r;if(document.createEventObject){r=document.createEventObject();t.fireEvent("on"+n,r)}else{r=document.createEvent("HTMLEvents");r.initEvent(n,true,false);t.dispatchEvent(r)}},toNode:function e(t){var n=document.createElement("div");n.innerHTML=t;var r=n.childNodes;for(var i=0;i<r.length;i++){if(_(r[i]))return r[i]}return null},appendTo:function e(t,n){var r=_(n)?n:this.toNode(n);t.appendChild(r);return r},prependTo:function e(t,n){var r=_(n)?n:this.toNode(n);t.insertBefore(r,t.childNodes[0]);return r},remove:function e(t){t.parentNode.removeChild(t)},after:function e(t,n){var r=_(n)?n:this.toNode(n);t.parentNode.insertBefore(r,t.nextSibling);return r},css:function e(t,n){for(var r in n){t.style[r]=n[r]}},attr:function e(t,n){for(var r in n){t.setAttribute(r,n[r])}},position:function e(t,n){n=n||window.event;var r=t.getBoundingClientRect();if(!n||!n.clientX)throw new Error("Event is necessary!");var i={x:n.clientX-r.left+t.scrollLeft,y:n.clientY-r.top+t.scrollTop};return i},copy:function e(t,n,r){var i=this.appendTo(document.body,"<textarea>"+t+"</textarea>");i.select();try{var o=window.document.execCommand("copy",false,null);if(o){if(f(n))n()}else{if(f(r))r()}}catch(e){if(f(r))r(e)}document.body.removeChild(i)}};function c(e){this.__helpCalcDOM.innerText=e;return this.__helpCalcDOM.offsetWidth}function p(e,t){if(arguments.length<2)t=t||this.__lineNum;var n=this._contentArray[t];if(e<=40)return 0;if(e-40>=this.$$textWidth(n))return n.length;var r=e-40,i=1;for(;i<n.length;i++){var o=Math.abs(e-40-this.$$textWidth(n.substr(0,i)));if(o>r)break;r=o}return i-1}function d(e,t){return{x:this.$$textWidth(this._contentArray[t].substr(0,e)),y:t*21}}function m(){return this.__cursor1.lineNum!=this.__cursor2.lineNum||this.__cursor1.leftNum!=this.__cursor2.leftNum}function y(e,t,n){var r=this;var i="";i+="<div style='min-width: fit-content;white-space: nowrap;line-height:21px;height:21px;'>";var o=n?"font-size:0;":"";i+="<em style='"+o+"color:"+this._colorNumber+";user-select: none;display:inline-block;font-style:normal;width:35px;text-align:right;margin-right:5px;'>"+(t+1)+"</em>";e.forEach(function(e){var t=e.content;t=t.replace(/\&/g,"&amp;");t=t.replace(/</g,"&lt;");t=t.replace(/>/g,"&gt;");i+="<span style='user-select: none;font-weight:"+r._fontWeight+";white-space: pre;color:"+e.color+"'>"+t+"</span>"});return i+"</div>"}function v(e){return{leftNum:e.__leftNum,lineNum:e.__lineNum,x:e.__cursorLeft,y:e.__cursorTop,lineHeight:21}}function N(){var t=this;this._el.innerHTML="";h.css(this._el,{"font-size":"12px",position:"relative",cursor:"text","font-family":this._fontFamily,background:this._colorBackground,overflow:"auto"});h.bind(this._el,"click",function(){setTimeout(function(){t.__focusDOM.focus()})});this.__helpCalcDOM=h.appendTo(this._el,"<span></span>");h.css(this.__helpCalcDOM,{position:"absolute","z-index":"-1","white-space":"pre",top:0,left:0,color:"rgba(0,0,0,0)","font-weight":this._fontWeight});this.__helpInputDOM=h.appendTo(this._el,"<div></div>");h.css(this.__helpInputDOM,{position:"absolute","z-index":1});h.bind(this.__helpInputDOM,"click",function(e){h.stopPropagation(e);h.preventDefault(e);t.__focusDOM.focus()});this.__focusDOM=h.appendTo(this._el,"<textarea></textarea>");h.css(this.__focusDOM,{position:"absolute",width:"6px","margin-top":"3px",height:"15px","line-height":"15px",resize:"none",overflow:"hidden",padding:"0",outline:"none",border:"none",background:"rgba(0,0,0,0)",color:this._colorCursor});h.attr(this.__focusDOM,{wrap:"off",autocorrect:"off",autocapitalize:"off",spellcheck:"false"});if(this._readonly){h.attr(this.__focusDOM,{readonly:true})}this.__showDOM=h.appendTo(this._el,"<div></div>");h.css(this.__showDOM,{padding:"10px 0"});this.__selectCanvas=h.appendTo(this._el,"<canvas></canvas>");h.css(this.__selectCanvas,{position:"absolute",left:"40px",top:"10px",opacity:"0.5"});this.$$updateCanvasSize(1,1)}function g(){h.css(this.__focusDOM,{left:40+this.$$textWidth(this._contentArray[this.__lineNum])+"px",top:10+this.__lineNum*21+"px"})}function $(){var n=this;if(this.__diff&&this.__diff.beginNum+this.__diff.endNum>10){var e=this.__showDOM.childNodes;var t=e.length;for(var r=t-this.__diff.endNum-1;r>=this.__diff.beginNum;r--){h.remove(e[r])}if(this.__diff.beginNum>0){for(var i=this.__formatData.length-1-this.__diff.endNum;i>=this.__diff.beginNum;i--){h.after(e[this.__diff.beginNum-1],this.$$toTemplate(this.__formatData[i],i,this._noLineNumber))}}else{for(var o=this.__formatData.length-this.__diff.endNum-1;o>=0;o--){h.prependTo(this.__showDOM,this.$$toTemplate(this.__formatData[o],o,this._noLineNumber))}}e=this.__showDOM.childNodes;for(var s=this.__diff.beginNum;s<this.__formatData.length;s++){e[s].getElementsByTagName("em")[0].innerText=s+1}}else if(this.__diff!="not update"){var l="";this.__formatData.forEach(function(e,t){l+=n.$$toTemplate(e,t,n._noLineNumber)});this.__showDOM.innerHTML=l}this.__diff="not update";var a=this.__showDOM.childNodes[this.__lineNum];if(!this._readonly&&this.__lineDom){this.__lineDom.style.backgroundColor="rgba(0, 0, 0, 0)";a.style.backgroundColor=this._colorEdit}this.__lineDom=a}function b(){var s=this;var l=this.__selectCanvas.getContext("2d");l.fillStyle=this._colorSelect;l.clearRect(0,0,this.__selectCanvas.scrollWidth,this.__selectCanvas.scrollHeight);var e=function e(t,n,r){var i=s.$$calcCanvasXY(t,r);var o=s.$$calcCanvasXY(n,r);if(t==n&&t==0){l.fillRect(i.x,i.y,5,21)}else{l.fillRect(i.x,i.y,o.x-i.x,21)}};if(this.__cursor1.lineNum==this.__cursor2.lineNum&&this.__cursor1.leftNum==this.__cursor2.leftNum)return;l.beginPath();if(this.__cursor1.lineNum==this.__cursor2.lineNum){e(this.__cursor1.leftNum,this.__cursor2.leftNum,this.__cursor1.lineNum)}else{var t,n;if(this.__cursor1.lineNum<this.__cursor2.lineNum){t=this.__cursor1;n=this.__cursor2}else{t=this.__cursor2;n=this.__cursor1}e(t.leftNum,this._contentArray[t.lineNum].length,t.lineNum);e(0,n.leftNum,n.lineNum);for(var r=t.lineNum+1;r<n.lineNum;r++){e(0,this._contentArray[r].length,r)}}}function w(){this.__cursorTop=this.__lineNum*21+10;this.__cursorLeft=40+this.$$textWidth(this._contentArray[this.__lineNum].substring(0,this.__leftNum));h.css(this.__focusDOM,{top:this.__cursorTop+"px",left:this.__cursorLeft+"px"})}function A(e,t){if(arguments.length<2){e=this._el.scrollWidth-40;t=this._el.scrollHeight-10}h.css(this.__selectCanvas,{width:e+"px",height:t+"px"});h.attr(this.__selectCanvas,{width:e,height:t})}function x(){this.$$updateCanvasSize(1,1);this.__cursor1={leftNum:0,lineNum:0};this.__cursor2={leftNum:0,lineNum:0}}function O(){var e=this.__cursor2,t=this.__cursor1;if(this.__cursor1.lineNum<this.__cursor2.lineNum){e=this.__cursor1;t=this.__cursor2}else if(this.__cursor1.lineNum==this.__cursor2.lineNum){if(this.__cursor1.leftNum<this.__cursor2.leftNum){e=this.__cursor1;t=this.__cursor2}}var n=this._contentArray[e.lineNum].substr(0,e.leftNum)+this._contentArray[t.lineNum].substr(t.leftNum);this._contentArray.splice(e.lineNum,t.lineNum-e.lineNum+1,n);this.__leftNum=this.__cursor1.leftNum=this.__cursor2.leftNum=e.leftNum;this.__lineNum=this.__cursor1.lineNum=this.__cursor2.lineNum=e.lineNum;this.$$cancelSelect()}var D=(e={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear"},_defineProperty(e,"45","insert"),_defineProperty(e,19,"pause"),_defineProperty(e,112,"f1"),_defineProperty(e,113,"f2"),_defineProperty(e,114,"f3"),_defineProperty(e,115,"f4"),_defineProperty(e,116,"f5"),_defineProperty(e,117,"f6"),_defineProperty(e,118,"f7"),_defineProperty(e,119,"f8"),_defineProperty(e,120,"f9"),_defineProperty(e,121,"f10"),_defineProperty(e,122,"f11"),_defineProperty(e,123,"f12"),_defineProperty(e,189,["-","_"]),_defineProperty(e,187,["=","+"]),_defineProperty(e,219,["[","{"]),_defineProperty(e,221,["]","}"]),_defineProperty(e,220,["\\","|"]),_defineProperty(e,186,[";",":"]),_defineProperty(e,222,["'",'"']),_defineProperty(e,188,[",","<"]),_defineProperty(e,190,[".",">"]),_defineProperty(e,191,["/","?"]),_defineProperty(e,192,["`","~"]),e);var M=["shift","ctrl","alt"];function k(e){e=e||window.event;var t=e.keyCode||e.which;var n=D[t]||t;if(!n)return;if(n.constructor!==Array)n=[n,n];var r=e.shiftKey?"shift+":"",i=e.altKey?"alt+":"",o=e.ctrlKey?"ctrl+":"";var s="",l=o+r+i;if(M.indexOf(n[0])>=0){n[0]=n[1]=""}var a=e.code=="Key"+e.key&&!r;s=l+(l==""&&a?n[1]:n[0]);if(n[0]==""){s=s.replace(/\+$/,"")}return s}function P(){var a=this;var t=false;var n=function e(t){var n=h.position(a._el,t);var r=Math.round((n.y-20.5)/21);if(r<0)r=0;if(r>=a._contentArray.length)r=a._contentArray.length-1;return{leftNum:a.$$bestLeftNum(n.x,r),lineNum:r}};var u=function e(){var t=a.__cursor2,n=a.__cursor1;if(a.__cursor1.lineNum<a.__cursor2.lineNum){t=a.__cursor1;n=a.__cursor2}else if(a.__cursor1.lineNum==a.__cursor2.lineNum){if(a.__cursor1.leftNum<a.__cursor2.leftNum){t=a.__cursor1;n=a.__cursor2}return a._contentArray[t.lineNum].substring(t.leftNum,n.leftNum)}var r="";r+=a._contentArray[t.lineNum].substr(t.leftNum)+"\n";for(var i=t.lineNum+1;i<n.lineNum;i++){r+=a._contentArray[i]+"\n"}r+=a._contentArray[n.lineNum].substr(0,n.leftNum);return r};h.bind(this._el,"mousedown",function(e){t=true;a.__cursor2=a.__cursor1=n(e);a.$$updateCanvasSize();a.$$updateSelectView()});h.bind(this._el,"mousemove",function(e){if(!t)return;a.__cursor2=n(e);a.$$updateSelectView()});h.bind(this._el,"mouseup",function(){return t=false});h.bind(this._el,"mouseout",function(){return t=false});h.bind(this._el,"click",function(e){a.__helpInputDOM.innerHTML="";var t=h.position(a._el,e);var n=Math.round((t.y-20.5)/21);if(n<0||n>=a._contentArray.length)return;a.__lineNum=n;a.__leftNum=a.$$bestLeftNum(t.x);a.$$updateCursorPosition();a.$$updateView()});var _=function e(t){t=t||a.__focusDOM.value;t=a.$$filterText(t);a.__focusDOM.value="";if(a.$$selectIsNotBlank())a.$$deleteSelect();if(/^\n$/.test(t)){if(a.__leftNum>=a._contentArray[a.__lineNum].length){a._contentArray.splice(a.__lineNum+1,0,"")}else{a._contentArray.splice(a.__lineNum+1,0,a._contentArray[a.__lineNum].substring(a.__leftNum));a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)}a.__lineNum+=1;a.__leftNum=0}else{var n=t.split(/\n/);if(n.length<=1){a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)+t+a._contentArray[a.__lineNum].substring(a.__leftNum);a.__leftNum+=t.length}else{var r;var i=a._contentArray[a.__lineNum].substring(0,a.__leftNum);var o=a._contentArray[a.__lineNum].substring(a.__leftNum);n[0]=i+n[0];n[n.length-1]+=o;(r=a._contentArray).splice.apply(r,[a.__lineNum,1].concat(_toConsumableArray(n)));a.__lineNum+=n.length-1;a.__leftNum=n[n.length-1].length-o.length}}a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n")));a.$$updateCursorPosition();a.$$updateView();a.__updated__()};h.bind(this.__focusDOM,"compositionstart",function(){a.__needUpdate=false;a.__focusDOM.style.color="rgba(0,0,0,0)";a.__focusDOM.style.borderLeft="1px solid "+a._colorCursor});h.bind(this.__focusDOM,"compositionend",function(){a.__needUpdate=true;a.__focusDOM.style.color=a._colorCursor;a.__focusDOM.style.borderLeft="none";_();if(a.$input!=null)a.__helpInputEvent=a.$input(a.__helpInputDOM,v(a),a._contentArray)||{}});h.bind(this.__focusDOM,"input",function(){if(a.__needUpdate){_();if(a.$input!=null)a.__helpInputEvent=a.$input(a.__helpInputDOM,v(a),a._contentArray)||{}}});var c=false;h.bind(this._el,"keyup",function(e){var t=k(e);if(t=="command")c=false});h.bind(this._el,"keydown",function(e){var t=k(e);if(t=="command")c=true;if(c&&["a","c","x"].indexOf(t)>-1){t="ctrl+"+t}if(a.__helpInputDOM.innerHTML!=""){var n=a.__helpInputEvent[t];if(f(n)){if(!n())return}else{a.__helpInputDOM.innerHTML=""}}if(a._readonly&&["ctrl+a","ctrl+c"].indexOf(t)<0)return;switch(t){case"ctrl+a":{a.__cursor1={leftNum:0,lineNum:0};a.__cursor2={lineNum:a._contentArray.length-1,leftNum:a._contentArray[a._contentArray.length-1].length};a.$$updateSelectView();break}case"ctrl+c":{if(a.$$selectIsNotBlank()){h.copy(u());a.__focusDOM.focus()}break}case"ctrl+x":{if(a.$$selectIsNotBlank()){h.copy(u());a.__focusDOM.focus();a.$$deleteSelect();a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n")));a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a.__updated__()}break}case"tab":{h.stopPropagation(e);h.preventDefault(e);var r="";for(var i=0;i<a._tabSpace;i++){r+=" "}if(a.$$selectIsNotBlank()){var o=a.__cursor1.lineNum,s=a.__cursor2.lineNum;if(o>s){o=a.__cursor2.lineNum;s=a.__cursor1.lineNum}for(var l=o;l<=s;l++){a._contentArray[l]=r+a._contentArray[l]}a.__cursor1.leftNum+=a._tabSpace;a.__cursor2.leftNum+=a._tabSpace;a.__leftNum+=a._tabSpace;a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n")));a.$$updateCursorPosition();a.$$updateView();a.$$updateCanvasSize();a.$$updateSelectView();a.__updated__()}else{_(r)}break}case"up":{if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a.$$bestLeftNum(a.$$textWidth(a._contentArray[a.__lineNum+1].substr(0,a.__leftNum))+40);a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a._el.scrollTop-=21;break}case"down":{if(a.__lineNum>=a._contentArray.length-1)return;a.__lineNum+=1;a.__leftNum=a.$$bestLeftNum(a.$$textWidth(a._contentArray[a.__lineNum-1].substr(0,a.__leftNum))+40);a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a._el.scrollTop+=21;break}case"left":{if(a.__leftNum<=0){if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a._contentArray[a.__lineNum].length}else{a.__leftNum-=1}a.$$updateCursorPosition();a.$$cancelSelect();break}case"right":{if(a.__leftNum>=a._contentArray[a.__lineNum].length){if(a.__lineNum>=a._contentArray.length-1)return;a.__lineNum+=1;a.__leftNum=0}else{a.__leftNum+=1}a.$$updateCursorPosition();a.$$cancelSelect();break}case"backspace":{if(a.$$selectIsNotBlank()){a.$$deleteSelect()}else{if(a.__leftNum<=0){if(a.__lineNum<=0)return;a.__lineNum-=1;a.__leftNum=a._contentArray[a.__lineNum].length;a._contentArray[a.__lineNum]+=a._contentArray[a.__lineNum+1];a._contentArray.splice(a.__lineNum+1,1)}else{a.__leftNum-=1;a._contentArray[a.__lineNum]=a._contentArray[a.__lineNum].substring(0,a.__leftNum)+a._contentArray[a.__lineNum].substring(a.__leftNum+1)}}a.__formatData=a.$$diff(a.$shader(a._contentArray.join("\n")));a.$$updateCursorPosition();a.$$updateView();a.$$cancelSelect();a.__updated__();break}}})}var S=function e(t,n){if(t.length!=n.length)return false;for(var r=0;r<t.length;r++){if(t[r].content!=n[r].content||t[r].color!=n[r].color)return false}return true};function C(e){var t=this.__formatData;if(t){var n=0;for(var r=0;r<t.length&&r<e.length;r++){if(!S(t[r],e[r])){break}n+=1}var i=0;for(var o=1;o<=t.length&&o<=e.length;o++){if(!S(t[t.length-o],e[e.length-o])){break}i+=1}var s=Math.min(t.length,e.length);if(n+i>=s){i=s-n-1;if(i<0)i=0}this.__diff={beginNum:n,endNum:i}}return e}function T(e){var t="";for(var n=0;n<this._tabSpace;n++){t+=" "}return e.replace(/\t/g,t)}function j(n,t){var r=[];var i=0;var e=function e(t){return n.substring(i,t+i>n.length?n.length:t+i)};var o="";var s="tag";var l=function e(){if(o!=""){r.push({color:{tag:t.selector,attr:t.attrKey,string:t.attrValue}[s],content:o})}o=""};while(true){if(e(2)=="/*"){l();while(e(2)!=="*/"&&i<n.length){o+=n[i++]}r.push({color:t.annotation,content:o+e(2)});i+=2;o=""}else if(["'",'"'].indexOf(e(1))>-1){var a=e(1);l();do{o+=n[i++]}while(e(1)!=a&&i<n.length);if(e(1)!=a){a=""}else{i+=1}r.push({color:t.attrValue,content:o+a});o=""}else if([":","{","}",";"].indexOf(e(1))>-1){l();r.push({color:t.insign,content:e(1)});o="";if(e(1)=="{"||e(1)==";"){s="attr"}else if(e(1)=="}"){s="tag"}else{s="string"}i+=1}else{if(i>=n.length){l();break}else{o+=n[i++]}}}return r}var E=["abstract","arguments","boolean","break","byte","case","catch","char","class","const","continue","debugger","default","delete","do","double","else","enum","eval","export","extends","false","final","finally","float","for","function","goto","if","implements","import","in","instanceof","int","interface","let","long","native","new","null","package","private","protected","public","return","short","static","super","switch","synchronized","this","throw","throws","transient","true","try","typeof","var","void","volatile","while","with","yield"];function L(n,t){var r=[];var i=0;var e=function e(t){return n.substring(i,t+i>n.length?n.length:t+i)};var o="";var s=function e(){if(o!=""){if(o[0]=="("){r.push({color:t.insign,content:"("});o=o.substr(1)}r.push({color:t.text,content:o})}o=""};while(true){if(e(2)=="/*"){s();while(e(2)!=="*/"&&i<n.length){o+=n[i++]}r.push({color:t.annotation,content:o+e(2)});i+=2;o=""}else if(e(2)=="//"){s();while(e(1)!=="\n"&&i<n.length){o+=n[i++]}r.push({color:t.annotation,content:o});o=""}else if(["'",'"',"`"].indexOf(e(1))>-1){var l=e(1);s();do{o+=n[i++]}while(e(1)!=l&&i<n.length);if(e(1)!=l){l=""}else{i+=1}r.push({color:t.string,content:o+l});o=""}else if(e(1)=="("&&(o[0]==" "||i-o.length-1>=0&&n[i-o.length-1]==" ")){r.push({color:t.funName,content:o});i+=1;o="("}else if(e(1)=="("){r.push({color:t.execName,content:o});i+=1;o="("}else if([";","{","}","(",")",".","\n","=","+",">","<","[","]","-","*","/","^","*","!"].indexOf(e(1))>-1){s();r.push({color:t.insign,content:e(1)});o="";i+=1}else if(e(1)==" "&&E.indexOf(o.trim())>-1){r.push({color:t.key,content:o+" "});o="";i+=1}else{if(i>=n.length){s();break}else{o+=n[i++]}}}return r}function I(n,r){var i=[];var o=0;var s=function e(t){return n.substring(o,t+o>n.length?n.length:t+o)};var l="";var e=function e(){if(l!=""){i.push({color:r.text,content:l})}l=""};var t=function e(){var t=" ";if(s(1)=='"')t='"';if(s(1)=="'")t="'";do{l+=n[o++]}while(s(1)!=t&&o<n.length);if(t!=" "&&o<n.length){l+=t;o+=1}i.push({color:r.attrValue,content:l});l=""};while(true){if(s(4)=="\x3c!--"){e();while(s(3)!=="--\x3e"&&o<n.length){l+=n[o++]}i.push({color:r.annotation,content:l+s(3)});o+=3;l=""}else if(s(2)=="</"){e();i.push({color:r.insign,content:"</"});o+=2;while(s(1)!==">"&&o<n.length){l+=n[o++]}if(l!=""){i.push({color:r.node,content:l});l="";if(o<n.length){i.push({color:r.insign,content:">"});o+=1}}}else if(s(1)=="<"&&s(2)!="< "){var a="";e();i.push({color:r.insign,content:"<"});o+=1;while(s(1)!=">"&&s(1)!=" "&&o<n.length){l+=n[o++]}if(l!=""){if(l=="style"||l=="script"){a="</"+l+">"}i.push({color:r.node,content:l});l="";if(o<n.length){while(o<n.length){if(s(1)==">"){e();i.push({color:r.insign,content:">"});o+=1;break}else if(s(1)!=" "){e();if(s(1)!='"'&&s(1)!="'"){while(s(1)!="="&&s(1)!=">"&&o<n.length&&s(1)!=" "){l+=n[o++]}if(l!=""){i.push({color:r.attrKey,content:l});l="";if(s(1)=="="){i.push({color:r.insign,content:"="});o+=1;if(o<n.length&&s(1)!=" "&&s(1)!=">"){t()}}}else{l+=n[o++]}}else if(s(1)=="="){i.push({color:r.insign,content:"="});o+=1}else{if(o<n.length&&s(1)!=" "&&s(1)!=">"){t()}}}else{l+=n[o++]}}}}if(a!=""){var u=o,_=l;while(s(a.length)!=a&&o<n.length){l+=n[o++]}if(o<n.length){var c=a.replace(/<\//,"");var f={"style>":j,"script>":L}[c](l,{"style>":r._css,"script>":r._javascript}[c]);f.forEach(function(e){i.push(e)});l=""}else{l=_;o=u}}}else{if(o>=n.length){e();break}else{l+=n[o++]}}}return i}var V=function e(t){var r=[[]],i=0;t.forEach(function(e){var t=e.content.split(/\n/);r[i].push({color:e.color,content:t[0]});for(var n=1;n<t.length;n++){i+=1;r.push([]);r[i].push({color:e.color,content:t[n]})}});return r};var W=function e(t,n){for(var r in n){try{t[r]=n[r]}catch(e){throw new Error("Illegal property value！")}}return t};var B={text:"#000000",annotation:"#6a9955",insign:"#ffffff",node:"#1e50b3",attrKey:"#1e83b1",attrValue:"#ac4c1e"};var z={annotation:"#6a9955",insign:"#ffffff",selector:"#1e50b3",attrKey:"#1e83b1",attrValue:"#ac4c1e"};var H={text:"#000000",annotation:"#6a9955",insign:"#ffffff",key:"#ff0000",string:"#ac4c1e",funName:"#1e50b3",execName:"#1e83b1"};function K(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var n,r;if(e=="html"){t._css=W(z,t.css);t._javascript=W(H,t.javascript);r=W(B,t);n=I}else if(e=="css"){r=W(z,t);n=j}else if(e=="javascript"){r=W(H,t);n=L}else{throw new Error("Language not supported:"+e+",The languages available include: html、css、javascript!")}return function(e){return V(n(e,r))}}var U=function e(t){var r=this;if(!(this instanceof e)){throw new Error("Open-Web-Editor is a constructor and should be called with the `new` keyword")}if(_(t.el)){var n=function e(){var t=[];r._contentArray.forEach(function(e){t.push([{content:e,color:r._colorText}])});return t};var i=function e(t){return t};this._el=t.el;this._el.owe_terminal="none";t.color=t.color||{};this._colorBackground=t.color.background||"#d6d6e4";this._colorText=t.color.text||"#000000";this._colorNumber=t.color.number||"#888484";this._colorEdit=t.color.edit||"#eaeaf1";this._colorCursor=t.color.cursor||"#ff0000";this._colorSelect=t.color.select||"#6c6cf1";this._fontFamily=t["font-family"]||"新宋体";this._fontWeight=t["font-weight"]||600;this._tabSpace=t.tabSpace||4;this._readonly=t.readonly||false;this._noLineNumber=t.noLineNumber||false;this._contentArray=a(t.content)?(this.$$filterText(t.content)+"").split("\n"):[""];this.$shader=f(t.shader)?t.shader:u(t.shader)?K.apply(void 0,_toConsumableArray(t.shader)):n;this.$format=f(t.format)?t.format:i;this.$input=f(t.input)?t.input:null}else{throw new Error("options.el is not a element!")}this.$$initDom();this.__needUpdate=true;this.__lineNum=this._contentArray.length-1;this.__leftNum=this._contentArray[this.__lineNum].length;this.__cursor1=this.__cursor2={leftNum:0,lineNum:0};this.__formatData=this.$$diff(this.$shader(this._contentArray.join("\n")));this.$$initView();this.$$updateView();this.$$bindEvent();this.__updated__=function(){};this.updated=function(e){r.__updated__=e};this.valueOf=function(){return r._contentArray.join("\n")};this.input=function(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"";var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(t!=0){if(n!=0){r._contentArray[r.__lineNum]=r._contentArray[r.__lineNum].substring(0,r.__leftNum+t)+r._contentArray[r.__lineNum].substring(r.__leftNum+t+n)}r.__leftNum+=t}r.__focusDOM.value=e;h.trigger(r.__focusDOM,"input");r.__focusDOM.focus()};this.format=function(){r._contentArray=r.$format(r._contentArray.join("\n"),r._tabSpace).split("\n");r.__lineNum=r._contentArray.length-1;r.__leftNum=r._contentArray[r.__lineNum].length;r.__formatData=r.$$diff(r.$shader(r._contentArray.join("\n")));r.$$updateView();r.$$initView()};this.copy=function(e,t){h.copy(r.valueOf(),e,t)}};U.prototype.$$textWidth=c;U.prototype.$$bestLeftNum=p;U.prototype.$$calcCanvasXY=d;U.prototype.$$selectIsNotBlank=m;U.prototype.$$filterText=T;U.prototype.$$toTemplate=y;U.prototype.$$initDom=N;U.prototype.$$initView=g;U.prototype.$$updateView=$;U.prototype.$$updateSelectView=b;U.prototype.$$updateCursorPosition=w;U.prototype.$$updateCanvasSize=A;U.prototype.$$cancelSelect=x;U.prototype.$$deleteSelect=O;U.prototype.$$bindEvent=P;U.prototype.$$diff=C;if((typeof module==="undefined"?"undefined":_typeof(module))==="object"&&_typeof(module.exports)==="object"){module.exports=U}else{window.OpenWebEditor=U}})();